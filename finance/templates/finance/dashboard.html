<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Green House Hostel Finance Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0fdf4;
            color: #065f46;
            margin: 40px;
        }
        h1 { color: #15803d; }
        table {
            width: 80%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 8px 12px;
            border: 1px solid #ccc;
        }
        th { background-color: #bbf7d0; }
        .filter {
            margin-bottom: 20px;
        }
        .section {
            margin-top: 40px;
        }
        /* Optional: pause scrolling on hover */
        #announcement-bar:hover #announcement-message {
            animation-play-state: paused;
        }
    </style>
</head>
<body>

    <!-- üóûÔ∏è Announcement Bar (shows one message at a time) -->
    <div id="announcement-bar" style="
        background-color:#bbf7d0;
        padding:10px 0;
        margin-bottom:20px;
        text-align:center;
        overflow:hidden;
        position:relative;
        height:40px;
    ">
        <div id="announcement-message" style="
            position:absolute;
            white-space:nowrap;
            font-size:1.1rem;
            color:#065f46;
            left:100%;
        "></div>
    </div>

    <h1>üè† Green House Hostel Finance Dashboard</h1>

    <div class="filter">
        <form method="get">
            <label for="month">Select Month:</label>
            <input type="month" id="month" name="month" value="{{ selected_month }}">
            <button type="submit">View</button>
            {% if month_name %}
                <p><strong>Showing records for:</strong> {{ month_name }}</p>
            {% endif %}
        </form>
    </div>

    <div class="section">
        <h2>üìÖ Monthly Summary</h2>
        <p><strong>Total Contributions:</strong> ‚Ç¶{{ total_contributions_month|floatformat:2 }}</p>
        <p><strong>Total Expenses:</strong> ‚Ç¶{{ total_expenses_month|floatformat:2 }}</p>
        <p><strong>Balance:</strong> ‚Ç¶{{ balance_month|floatformat:2 }}</p>

        <h3>Room Contributions ({{ month_name|default:"All Months" }})</h3>
        <table>
            <tr>
                <th>Room</th>
                <th>Total (‚Ç¶)</th>
            </tr>
            {% for r in room_data %}
            <tr>
                <td>{{ r.room }}</td>
                <td>{{ r.total|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="2">No rooms found</td></tr>
            {% endfor %}
        </table>

        <h3>Expenses ({{ month_name|default:"All Months" }})</h3>
        <table>
            <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Amount (‚Ç¶)</th>
            </tr>
            {% for e in expenses %}
            <tr>
                <td>{{ e.date_added|date:"d M, Y" }}</td>
                <td>{{ e.description }}</td>
                <td>{{ e.amount|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3">No expenses recorded.</td></tr>
            {% endfor %}
        </table>
    </div>

    <div class="section">
        <h2>üí∞ Overall Summary (All Time)</h2>
        <p><strong>Total Contributions:</strong> ‚Ç¶{{ total_contributions_all|floatformat:2 }}</p>
        <p><strong>Total Expenses:</strong> ‚Ç¶{{ total_expenses_all|floatformat:2 }}</p>
        <p><strong>Balance:</strong> ‚Ç¶{{ balance_all|floatformat:2 }}</p>
    </div>

    <script>
       
    const announcements = [
        {% for a in announcements %}
            {
                text: "{{ a.message|escapejs }}",
                important: {% if a.is_important %}true{% else %}false{% endif %}
            }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];


        let currentIndex = 0;
        const msgDiv = document.getElementById("announcement-message");

        function showNextMessage() {
            if (announcements.length === 0) return;

            const item = announcements[currentIndex];
            msgDiv.textContent = item.text;

            // Style based on importance
            msgDiv.style.fontWeight = item.important ? "normal" : "bold";
            msgDiv.style.color = item.important ? "#064e3b" : "#065f46";

            // Restart animation
            msgDiv.style.animation = "none";
            void msgDiv.offsetWidth; // reflow trick
            msgDiv.style.animation = "scrollMessage 10s linear forwards";

            // After animation ends, show next
            setTimeout(() => {
                currentIndex = (currentIndex + 1) % announcements.length;
                showNextMessage();
            }, 10000); // 10s per message
        }

        // Define CSS keyframes
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes scrollMessage {
                0% { left: 100%; opacity: 1; }
                100% { left: -100%; opacity: 1; }
            }
        `;
        document.head.appendChild(style);

        // Start the loop
        showNextMessage();
    </script>
</body>
</html>
