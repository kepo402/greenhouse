<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green House Hostel Finance Dashboard</title>
    <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f0fdf4;
    color: #065f46;
    margin: 40px;
    line-height: 1.6;
}

h1 {
    color: #15803d;
    margin-bottom: 10px;
}

table {
    width: 80%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    padding: 10px 12px;
    border: 1px solid #ccc;
}

th {
    background-color: #bbf7d0;
}

.filter {
    margin-bottom: 20px;
}

.section {
    margin-top: 40px;
}

/* ‚úÖ Announcement hover pause */
#announcement-bar:hover #announcement-message {
    animation-play-state: paused;
}

/* üì± Tablet screens */
@media (max-width: 768px) {
    body {
        margin: 20px;
        font-size: 1rem;
        line-height: 1.5;
    }

    h1 {
        font-size: 1.4rem;
        text-align: center;
    }

    table {
        width: 100%;
        font-size: 1rem;
    }

    th, td {
        padding: 8px;
    }
}

/* üì± Small screens (‚â§500px) ‚Äî convert tables to cards */
@media (max-width: 500px) {
    body {
        margin: 12px;
        font-size: 1.05rem;
        line-height: 1.7;
    }

    h1 {
        font-size: 1.5rem;
        text-align: center;
        margin-bottom: 15px;
    }

    h2, h3 {
        font-size: 1.25rem;
        margin-top: 25px;
    }

    /* üü© Convert tables into card lists */
    table {
        display: none; /* Hide the old table */
    }

    .mobile-card-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .mobile-card {
        background-color: #bbf7d0;
        border: 1px solid #a7f3d0;
        border-radius: 8px;
        padding: 10px 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .mobile-card p {
        margin: 4px 0;
        font-size: 1rem;
    }

    input, select, button {
        font-size: 1rem;
        padding: 8px 10px;
    }

    #announcement-bar {
        height: 50px;
        padding: 8px 0;
    }

    #announcement-message {
        font-size: 1.2rem !important;
        line-height: 50px;
    }

    .filter label {
        display: block;
        font-size: 1.1rem;
        margin-bottom: 5px;
    }

    #month {
        width: 100%;
        font-size: 1.2rem;
        padding: 10px;
        border: 1px solid #a7f3d0;
        border-radius: 6px;
        margin-bottom: 10px;
    }

    .filter button {
        width: 100%;
        font-size: 1.1rem;
        padding: 10px;
        background-color: #15803d;
        color: white;
        border: none;
        border-radius: 6px;
    }

    .filter button:hover {
        background-color: #166534;
    }
}

/* ‚úÖ Fix for smaller/older Android phones (itel, Tecno, Infinix) */
@media (max-width: 600px) {
    body {
        font-size: 1.1rem;
        line-height: 1.7;
    }

    #announcement-bar {
        height: 55px;
        padding: 8px 0;
    }

    #announcement-message {
        font-size: 1.25rem !important;
        line-height: 55px;
    }

    #month {
        width: 100%;
        font-size: 1.25rem;
        padding: 12px;
    }

    .filter button {
        font-size: 1.2rem;
        padding: 12px;
    }

    table, .mobile-card p {
        font-size: 1.1rem;
    }
}



    </style>
</head>
<body>

    <!-- üóûÔ∏è Announcement Bar (shows one message at a time) -->
    <div id="announcement-bar" style="
        background-color:#bbf7d0;
        padding:10px 0;
        margin-bottom:20px;
        text-align:center;
        overflow:hidden;
        position:relative;
        height:40px;
    ">
        <div id="announcement-message" style="
            position:absolute;
            white-space:nowrap;
            font-size:1.1rem;
            color:#065f46;
            left:100%;
        "></div>
    </div>

    <h1>üè† Green House Hostel Finance Dashboard</h1>

    <div class="filter">
        <form method="get">
            <label for="month">Select Month:</label>
            <input type="month" id="month" name="month" value="{{ selected_month }}">
            <button type="submit">View</button>
            {% if month_name %}
                <p><strong>Showing records for:</strong> {{ month_name }}</p>
            {% endif %}
        </form>
    </div>

    <div class="section">
        <h2>üìÖ Monthly Summary</h2>
        <p><strong>Total Contributions:</strong> ‚Ç¶{{ total_contributions_month|floatformat:2 }}</p>
        <p><strong>Total Expenses:</strong> ‚Ç¶{{ total_expenses_month|floatformat:2 }}</p>
        <p><strong>Balance:</strong> ‚Ç¶{{ balance_month|floatformat:2 }}</p>

        <h3>Room Contributions ({{ month_name|default:"All Months" }})</h3>
<table>
    <tr>
        <th>Room</th>
        <th>This Month (‚Ç¶)</th>
        <th>All Time (‚Ç¶)</th>
    </tr>
    {% for r in room_data %}
    <tr>
        <td>{{ r.room }}</td>
        <td>{{ r.month_total|floatformat:2 }}</td>
        <td>{{ r.overall_total|floatformat:2 }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">No rooms found</td></tr>
    {% endfor %}
</table>


<div class="mobile-card-list">
    {% for r in room_data %}
        <div class="mobile-card">
            <p><strong>Room:</strong> {{ r.room }}</p>
            <p><strong>This Month:</strong> ‚Ç¶{{ r.month_total|floatformat:2 }}</p>
            <p><strong>All Time:</strong> ‚Ç¶{{ r.overall_total|floatformat:2 }}</p>
        </div>
    {% empty %}
        <div class="mobile-card">
            <p>No rooms found</p>
        </div>
    {% endfor %}
</div>


<h3>Expenses ({{ month_name|default:"All Months" }})</h3>
<table>
    <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Amount (‚Ç¶)</th>
    </tr>

    {% for e in expenses_month %}
    <tr style="background-color:#ecfdf5;">
        <td>{{ e.date_added|date:"d M, Y" }}</td>
        <td>{{ e.description }}</td>
        <td>{{ e.amount|floatformat:2 }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">No expenses recorded for this month.</td></tr>
    {% endfor %}

    <tr><td colspan="3" style="background:#a7f3d0; font-weight:bold;">All Expenses (Total List)</td></tr>

    {% for e in expenses_all %}
    <tr>
        <td>{{ e.date_added|date:"d M, Y" }}</td>
        <td>{{ e.description }}</td>
        <td>{{ e.amount|floatformat:2 }}</td>
    </tr>
    {% endfor %}
</table>

    </div>
    <div class="mobile-card-list">
        {% if expenses_month %}
            <h3 style="margin-top:15px;">Expenses for {{ month_name|default:"This Month" }}</h3>
            {% for e in expenses_month %}
                <div class="mobile-card" style="background-color:#ecfdf5;">
                    <p><strong>Date:</strong> {{ e.date_added|date:"d M, Y" }}</p>
                    <p><strong>Description:</strong> {{ e.description }}</p>
                    <p><strong>Amount:</strong> ‚Ç¶{{ e.amount|floatformat:2 }}</p>
                </div>
            {% endfor %}
        {% else %}
            <div class="mobile-card">
                <p>No expenses recorded for this month.</p>
            </div>
        {% endif %}
    
        <!-- üü© Collapsible All Expenses section -->
        <button id="toggle-all-expenses" style="
            margin-top:20px;
            width:100%;
            font-size:1.1rem;
            padding:10px;
            background-color:#15803d;
            color:white;
            border:none;
            border-radius:6px;
        ">
            Show All Expenses ‚ñº
        </button>
    
        <div id="all-expenses-section" style="display:none; margin-top:10px;">
            {% for e in expenses_all %}
                <div class="mobile-card">
                    <p><strong>Date:</strong> {{ e.date_added|date:"d M, Y" }}</p>
                    <p><strong>Description:</strong> {{ e.description }}</p>
                    <p><strong>Amount:</strong> ‚Ç¶{{ e.amount|floatformat:2 }}</p>
                </div>
            {% empty %}
                <div class="mobile-card">
                    <p>No expenses recorded at all.</p>
                </div>
            {% endfor %}
        </div>
    </div>
    

    <div class="section">
        <h2>üí∞ Overall Summary (All Time)</h2>
        <p><strong>Total Contributions:</strong> ‚Ç¶{{ total_contributions_all|floatformat:2 }}</p>
        <p><strong>Total Expenses:</strong> ‚Ç¶{{ total_expenses_all|floatformat:2 }}</p>
        <p><strong>Balance:</strong> ‚Ç¶{{ balance_all|floatformat:2 }}</p>
    </div>

    <script>

document.addEventListener("DOMContentLoaded", function() {
    const toggleButton = document.getElementById("toggle-all-expenses");
    const section = document.getElementById("all-expenses-section");

    toggleButton.addEventListener("click", function() {
        const isHidden = section.style.display === "none";
        section.style.display = isHidden ? "block" : "none";
        toggleButton.textContent = isHidden ? "Hide All Expenses ‚ñ≤" : "Show All Expenses ‚ñº";
    });
});

document.addEventListener("DOMContentLoaded", function() {
    const monthInput = document.getElementById("month");
    const form = monthInput.closest("form");

    if (!monthInput.value) {
        const now = new Date();
        const currentMonth = now.toISOString().slice(0, 7); // e.g. "2025-10"
        monthInput.value = currentMonth;

        // üîÑ Automatically submit to show current month‚Äôs data
        form.submit();
    }
});

        const announcements = [
            {% for a in announcements %}
                {
                    text: "{{ a.message|escapejs }}",
                    important: {% if a.is_important %}true{% else %}false{% endif %}
                }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
    
        const msgDiv = document.getElementById("announcement-message");
        let currentIndex = 0;
    
        function animateMessage() {
            if (announcements.length === 0) return;
    
            const item = announcements[currentIndex];
            msgDiv.textContent = item.text;
    
            // Style important vs normal
            msgDiv.style.fontWeight = item.important ? "bold" : "normal";
            msgDiv.style.color = item.important ? "#064e3b" : "#065f46";
    
            const containerWidth = msgDiv.parentElement.offsetWidth;
            const textWidth = msgDiv.scrollWidth;
    
            let pos = containerWidth;
            const speed = window.innerWidth <= 500 ? 1.2 : 2; // slower on small screens
    
            // Smooth JS animation (not CSS)
            function step() {
                pos -= speed;
                msgDiv.style.left = pos + "px";
    
                if (pos + textWidth > 0) {
                    requestAnimationFrame(step);
                } else {
                    // move to next message
                    currentIndex = (currentIndex + 1) % announcements.length;
                    setTimeout(animateMessage, 500); // small pause before next
                }
            }
    
            // reset position and start
            msgDiv.style.left = containerWidth + "px";
            requestAnimationFrame(step);
        }
    
        // start animation
        animateMessage();
    
        // re-trigger when resized
        window.addEventListener("resize", () => {
            msgDiv.style.left = "100%";
        });
    </script>
    
</body>
</html>
